services:
  provider:
    build: 
      context: ./broadcaster/
      dockerfile: ./docker/DockerfileProvider
    ports:
      - 2345:2345
    volumes:
      - shared_memory:/dev/shm
      - ./broadcaster/saved_video_frame:/app/saved_video_frame
    shm_size: 256m
    tmpfs:
      - /shared:size=256m

  viewer:
    build: 
      context: ./broadcaster/
      dockerfile: ./docker/DockerfileViewer
    ports:
      - 8080:8080
      - 2346:2345

  camera:
    build: 
      context: ./camera/
      dockerfile: ./Dockerfile
    volumes:
      - shared_memory:/dev/shm
    shm_size: 256m
    tmpfs:
      - /shared:size=256m
    command: "python detect.py"
    devices:
      - /dev/video0:/dev/video0

  app:
    build: 
      context: ./viewer/
      dockerfile: ./Dockerfile
    ports:
      - 8081:8081
    volumes:
      - ./viewer/:/app

  server:
    build: 
      context: ./broadcaster/
      dockerfile: ./docker/DockerfileMisc
    command: "./bin/server"
    ports:
      - 8071:8071
      - 2334:2345
    profiles: [debug]

  watcher:
    build: 
      context: ./broadcaster/
      dockerfile: ./docker/DockerfileMisc
    volumes:
      - ./broadcaster/saved_video_frame:/app/saved_video_frame
    command: "./bin/watcher"
    ports:
      - 8072:8072
      - 2335:2345
    profiles: [debug]
volumes:
  shared_memory: